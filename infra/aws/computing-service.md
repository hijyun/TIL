# 컴퓨팅 서비스


## 요약
![image](https://github.com/hijyun/TIL/assets/54613024/c3087cf5-e38a-47e5-b0e4-3308e59f01d5)


</br>
</br>
</br>


## 인스턴스 유형
![image](https://github.com/hijyun/TIL/assets/54613024/6ccf9f3d-84a4-48c5-a8b8-7384d04b0960)


- EC2는 현재 5가지 인스턴스 제품군 (범용, 컴퓨팅 최적화, 메모리 최적화, 스토리지 최적화 및 가속 컴퓨팅)이 있으며, 19가지 인스턴스 유형이 있다. 각 유형은 제품군 중 하나에 속한다.

</br>
</br>

- EC2 인스턴스 명명 규칙은

<img src="https://github.com/hijyun/TIL/assets/54613024/a8d1ce6c-2ce5-4c20-bff2-fd246d810897" alt="대체 텍스트"  height="150">



</br>
</br>

|||
|----|-----|
|C|인스턴스 유형|c유형|
|6|인스턴스 세대|6세대|
|i|추가 기능|i -인텔 프로세서|
|.large|인스턴스 크기|large - 2vCPU, 4GiB메모리, 최대 12.5GiB 네트워크 대역폭, 최대 10Gbps EBS 대역폭|


</br>
</br>

- 버스트 가능 성능 인스턴스는 워크로드가 인스턴스의 기준 용량에서 작동할 때 CPU 크레딧을 누적한다. 각 CPU 크레딧은 1분 동안 전체 CPU 코어의 성능을 버스트할 수 있는 기회를 제공한다.

- 동일한 유형 내에서 인스턴스 크기가 커질 때마다 프로비저닝된 리소스 양이 두배 증가하고, 그에 따라 온디맨드 비용도 두 배 증가한다.

- EC2 인스턴스의 온디멘드 인스턴스 요금은 종량제 기준으로 계정 내에서 실행 중인 인스턴스에 대해서만 요금이 청구된다. 가격은 인스턴스가 시작된 후 종료 또는 중지될 때까지 각 인스턴스에 대해 소비된 인스턴스 시간에 따라 부과된다.

    - 리눅스, SQL 엔터프라이즈, 윈도우, SQL 스탠더드 포함 윈도우, SQL 웹 인스턴스 포함 윈도우의 경우 초당 청구

    - 레드햇 엔터프라이즈 리눅스(RHEL) 또는 수세 엔터프라이즈 리눅스 서버(SLES)와 같은 유형의 경우 전체 시간으로 청구된다.

    - 사용 시간은 정수배로 계산된다. 예를들어 RHEL인스턴스가 1시간 5초 동안 실행되는 경우 2시간에 대한 요금이 청구되고, 리눅스 인스턴스의 경우 1시간 5초에 대한 요금이 부과된다.

- 리전과 로컬 영역에 따라 비용이 달라진다. GovCloud리전에서 실행하는 경우 미국 동부 리전의 인스턴스 보다 26% 더 많은 비용이 발생할 수 있다.

- EC2 인스턴스를 구동할 때 공유(기본) 인스턴스, 전용 호스트 또는 베어메탈 인스턴스 중에 테넌시 옵션을 선택할 수 있다. 공유 테넌시에서는 여러 사용자가 동일한 물리 호스트에서 제공하는 컴퓨팅 리소스를 사용할 수 있다. 전용 호스트 및 베어메탈 인스턴스는 호스트의 모든 리소스가 프로비저닝 되며 한 번에 하나의 클라우드 계정에서만 사용된다. 호스트가 특정 사용자에게 할당되면 다른 AWS 계정은 이 리소스를 사용할 수 없다.

</br>

### 전용 호스트 vs 온디멘드

 - C6i 전용 호스트의 비용은 c6i.large 공유 인스턴스 또는 동등한 리소스를 가진 c6i.32xlarge 공유 인스턴스의 누적 비용 보다 10 % 높다.  

 </br>


### 베어메탈 vs 온디멘드

- 가상화 계층이 필요하지 않은 경우 베어 메탈 인스턴스와 공유 인스턴스의 비용이 동일하다.


</br>

- CPU EC2 인스턴스 최적화를 사용하면 인텔 또는 AMD 하이퍼스레딩을 사용하지 않도록 설정(코어 당 단일 스레드로 설정)하고, 인스턴스와 함께 제공할 사용자 설정 vCPU 를 지정할 수 있다.

- Elastic Graphics을 사용하면 그래픽 메모리가 있는 그래픽 가속기를 광범위한 윈도우 EC2 인스턴스에 연결할 수 있다.

- 일래스틱 추론을 사용하면 모든 EC2 및 SageMaker 인스턴스 또는 아마존 ECS 작업에 GPU 기반 가속을 연결하여 딥러닝 추론을 실행할 수 있다. Tensorflow, 아파치 MXNet, PyTorch, ONNX 모델을 지원한다.

</br>
</br>
</br>

 

## EC2 구매 옵션
아마존에서는 5가지 EC2 리소스 구매 방법을 제공한다.

|Options|Description|
|---------|-----------|
|On-demand instance |장기 약정 없이 초 단위 또는 시간 단위로 컴퓨팅 용량에 대해 비용을 지불하는 방식|
|Reserved Instance(RI)|12개월 또는 36개월 동안 예약된 용량에 대해 비용을 지불하는 대신 온디맨드 가격에 비해 72% 할인된 가격을 제공|
|Saving Plan|예약 인스턴스와 유사하게 12개월 또는 36개월 동안 약정된 지출(시간 당 달러)을 대가로 EC2 온디맨드 가격에서 최대 72% 할인을 제공. 예약 인스턴스와 동일한 할인율을 제공하지만 유연성과 적용 범위가 더 높다.|
|On-demand capacity reservation|EC2 인스턴스 용량을 일정 기간 동안 특정 가용 영역에서 예약할 수 있음. SP나 RI와는 무관. 약정 x. 필요하지 않으면 취소할 수 있음.|
|Spot instance|EC2온디맨드 가격에 비해 최대 90%할인된 가격으로 EC2용량을 활용 가능. |

</br>
<br>
</br>

## Reserved Instance
- 예약 인스턴스는 예약 사항(테넌시, 플랫폼, 리전 ,가용 영역, 인스턴스 유형 및 인스턴스 크기)이 실행 중인 인스턴스와 일치할 경우 예약 인스턴스 가격이 온디맨드 인스턴스에 자동으로 적용된다.

- 크기의 유연성

    - 크기를 유연하게 설정하면 지정된 인스턴스의 크기에 관계없이 조건과 일치하는 실행 중인 인스턴스에 할인을 적용할 수 있다. 

    - ex. 동부 리전의 리눅스 c6i.2xlarge 예약 인스턴스는 동일한 리전의 c6i.xlarge, 6cilarge, c6i.medium 인스턴스에도 적용할 수 있다.

    - 정규화 인수를 기반으로 유연성 매커니즘을 제공한다. 예약한 인스턴스의 정규화 인수만큼 인스턴스 크기를 적용할 수 있다. 

    - 인스턴스 크기의 유연성은 특정 가용 영역, 베어 메탈 인스턴스 또는 전용 테넌시가 있는 예약된 인스턴스에는 적용되지 않는다. 또한, RHEL or SLES를 실행하는 예약 인스턴스에는 적용되지 않는다.

    - 예약 할인 공유 활성화를 선택하면 구매 계정 남은 예약  시간 할인을 다른 연결 계정의 인스턴스에 공유할 수 있다.

</br>
</br>

<img src="https://github.com/hijyun/TIL/assets/54613024/1eda980d-32b0-478e-a0c4-0c9b6c18df03" alt="대체 텍스트" height="400">


</br>

- 장기 예약 위험성 완화 방법

    - 컨버터블 예약 (요구사항이나 워크로드가 변경될 경우 약정을 수정할 수 있다.)

    - 마켓 플레이스 (불필요한 예약 인스턴스를 판매할 수 있다.)

- 표준 예약과 컨버터블 예약 모두 1. 동일 리전 내의 가용 영역 변경 2. 예약 범위를 가용 영역에서 리전으로 변경 (또는 그 반대로) 3. 동일 인스턴스 유형 내에서 인스턴스의 크기 변경 이 가능하다.  컨버터블 예약의 경우 인스턴스 유형 및 세대 변경이 가능하다.

- 예약을 변경할 때는 원래 예약의 정규화 인수의 합과 일치해야 한다.


</br>
</br>

## Saving Plan
- 특정 인스턴스 유형을 구매하는 약정 대신 주어진 사용량 만큼 약정하는 방식

    - ex. 시간 당 10달러의 사용량을 약정하는 경우 해당 사용량가지는 세이빙 플랜 가격으로 할인받지만, 약정을 초과하는 사용량은 온드맨드 요금이 청구된다.

- Saving Plan의 유형은 2가지가 있다.

1. **EC2 인스턴스 세이빙 플랜**  : 리전, 인스턴스 유형, 기간, 결제 옵션, 시간 약정을 지정한다.

2. **컴퓨트 세이빙 플랜** : 시간 약정만 지정한다.
</br>
</br>

- EC2 인스턴스 세이빙 플랜의 할인율은 표준 예약 인스턴스의 할인율과 비슷하다.

- 컴퓨트 세이빙 플랜의 할인율은 컨버터블 예약 인스턴스의 할인율과 비슷하다.

- 리눅스, RHEL 및 윈도우 OS의 경우 RI와 SP의 할인율이 동일하다. SELS의 경우 RI가 SP보다 더 저렴하다.

</br>
</br>

 

## Spot Instance
- 스팟 인스턴스는 최대 90% 할인된 가격으로 제공되는 EC2 인스턴스로서, 약정을 하지 않고 비용을 절감할 수 있는 기회를 제공한다. 

- 스팟인스턴스를 사용할 경우 인스턴스 중단으로 애플리케이션의 안정성의 문제를 완화하기 위해

    - 오토 스케일링 그룹, EC2 플릿, AWS 스팟 인스턴스 어드바이저, 스팟 배치 점수 및 스팟 중단 주입을 조합하여 사용할 수 있다.

- 스팟 인스턴스 풀, 스팟 인스턴스 어드바이저, 스팟  

 
 </br>
</br>


# 참고자료
AWS 비용 최적화 바이블 - 핀옵스를 위한 최적의 기술 활용부터 운영 노하우까지 
